---
title: "Topographic, single-cell gene expression profiling of Periaqueductal Gray neurons"
subtitle: "Part VIII: data exploration via violin, heatmaps, and other plots"
author:
  - name: "Oriol Pavon Arocas, Sarah F. Olesen, and Tiago Branco"
    affiliation: "Sainsbury Wellcome Centre for Neural Circuits and Behaviour, University College London, UK"
    email: "oriol.pavon.16@ucl.ac.uk"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_notebook:
    highlight: pygments
    number_sections: FALSE
    theme: lumen
    toc: TRUE
    toc_float: TRUE

#output: rmdformats::readthedown:
  #highlight: pygments
---

***

This is a pipeline to analyse single-cell RNA sequencing data from Periaqueductal Gray neurons (1) isolated from acute midbrain slices of transgenic mice using visually guided aspiration via patch pipettes and (2) processed using SMART-seq2 (Picelli et al., Nature Protocols 2014). 

This pipeline has been generated after attending the [EMBL-EBI RNA-Sequence Analysis Course](https://www.ebi.ac.uk/training/events/2019/rna-sequence-analysis) and [attending](https://training.csx.cam.ac.uk/bioinformatics/event/2823386) and following the online course on [Analysis of single cell RNA-seq data](https://github.com/hemberg-lab/scRNA.seq.course) by the [Hemberg Lab](https://www.sanger.ac.uk/science/groups/hemberg-group). Many other resources have been used, including the [Orchestrating Single-Cell Analysis with Bioconductor book](https://osca.bioconductor.org/) by Robert Amezquita and Stephanie Hicks, the [simpleSingleCell workflow in Bioconductor](https://bioconductor.org/packages/3.9/workflows/html/simpleSingleCell.html) maintained by Aaron Lun, the [rnaseqGene workflow](https://bioconductor.org/packages/3.10/workflows/html/rnaseqGene.html) maintained by Michael Love, the [RNAseq123 workflow](https://bioconductor.org/packages/3.10/workflows/html/RNAseq123.html) maintained by Matthew Ritchie, and the [EGSEA123 workflow](https://bioconductor.org/packages/3.10/workflows/html/EGSEA123.html) maintained by Matthew Ritchie.

Other key resources include [Bioconductor](http://www.bioconductor.org/) (Huber et al., Nature Methods 2015), [scRNA-tools](https://www.scrna-tools.org/), `scater` (McCarthy et al., Bioinformatics 2017), `scran` (Lun et al., F1000Res 2016), `SC3` (Kiselev et al., Nature Methods 2017), `Seurat` (Butler et al., Nature Biotechnology 2018), `clusterExperiment` (Risso et al., PLOS Computational Biology 2018), `limma` (Ritchie et al., Nucleic Acids Research 2015), `DESeq2` (Love et al., Genome Biology 2014), `edgeR` (Robinson et al., Bioinformatics 2010), `MAST` (Finak, McDavid, Yajima et al., Genome Biology 2015), `iSEE` (Rue-Albrecht & Marini et al., F1000Research 2018), `t-SNE` (van der Maaten & Hinton, Journal of Machine Learning Research 2008), `UMAP` (McInnes et al., arXiv 2018), and the [Mathematical Statistics and Machine Learning for Life Sciences](https://towardsdatascience.com/tagged/stats-ml-life-sciences) column by Nikolay Oskolkov.

***

# STEP 8 | Data exploration
Load the `PAG_sceset_qc_norm_filt_corr` after normalization, filtering, and batch correction. We should thus have a `corrected` slot in `assays`:
```{r}
set.seed(1991)
library(SC3)
library(scater)
library(SingleCellExperiment)
library(pheatmap)
library(mclust)

PAG_sceset_qc_norm_filt_corr <- readRDS("PAG_sceset_qc_norm_filt_corr.rds")
assayNames(PAG_sceset_qc_norm_filt_corr)
PAG_sceset_qc_norm_filt_corr
```

## Step 8.1 | Visualizing data in low-dimensional space with PCA
Principal component analysis (PCA) is a statistical procedure that uses a transformation to convert a set of observations into a set of values of linearly uncorrelated variables called principal components (PCs). The number of principal components is less than or equal to the number of original variables. Mathematically, the PCs correspond to the eigenvectors of the covariance matrix. The eigenvectors are sorted by eigenvalue so that the first principal component accounts for as much of the variability in the data as possible, and each succeeding component in turn has the highest variance possible under the constraint that it is orthogonal to the preceding components.

We can apply PCA to visualize the relationships between cells in our dataset. Cells with similar expression profiles should be located close together in the plot, while dissimilar cells should be far apart. Ideally, we do this using the `logcounts` of our `SingleCellExperiment` object. Log-transformation reduces the variance on the first principal component, separates some biological effects, and makes the distribution of the expression values more normal. BUT - log-transformation is not a proper normalisation step and is not enough to account for different technical factors between the cells (e.g. sequencing depth). Therefore, we should not use `logcounts_raw` for our downstream analysis, but instead use the __logcounts__ slot of the `SingleCellExperiment` object as a minimum suitable data, which is not just log-transformed, but also normalised by library size. By default `scater` only uses the top 500 most variable genes to calculate the PCA, but this can be adjusted by changing the __ntop__ argument. We can also choose to only use our HVGs, or any given list of genes we may obtain by other feature selection strategies.

We can use PCA to compare the effects of our normalisation and batch correction. If we plot the PCAs using the `size_by = total_features_by_counts` we can assess whether the total features correlates with the PCs: if there is a correlation with the total features, we will see that the cells are distributed in a particular way (e.g. with small bubbles on the left and large bubbles on the right). We should not observe a clear separation of cells by batch (`batch.processing` or `mouse.id`), indicating that our batch correction step using `removeBatchEffect()` was successful.
```{r}
set.seed(1991)
for(n in assayNames(PAG_sceset_qc_norm_filt_corr)) {
    print(
        plotPCA(
            PAG_sceset_qc_norm_filt_corr,
            rerun = TRUE, 
            colour_by = "PAG.area",
            shape_by = "cell.type",
            size_by = "total_features_by_counts",
            run_args=list(exprs_values = n, feature_set = metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt[1:1000]) # ntop = 1000
        ) + ggtitle(n) 
        + coord_cartesian(xlim = c(-35, 35), ylim = c(-35, 35))
        #+ coord_cartesian(xlim = c(-50, 50), ylim = c(-60, 60))
    )
}
```

We can also visualize the relationships between cells by constructing pairwise PCA plots for the first components. Cells with similar expression profiles should be located close together in the plot, while dissimilar cells should be far apart. Additional components can be visualized by increasing the `ncomponents` argument in `plotPCA` to construct pairwise plots. The percentage of variance explained by each component can also be obtained by running `plotPCA` with `return_SCESet = TRUE`, and then calling `reducedDimension` on the returned object. This information may be useful for selecting high-variance components (possibly corresponding to interesting underlying factors) for further examination.
```{r}
plotReducedDim(PAG_sceset_qc_norm_filt_corr,
               use_dimred = "PCA",
               ncomponents = 4,
               colour_by="batch.processing") + fontsize
```

Note that `plotReducedDim()` will use the PCA results that were already stored in `SCE` by `denoisePCA()` or any other instance of `runPCA()`. This allows us to rapidly generate new plots with different aesthetics, without repeating the entire PCA computation. Similarly, `plotPCA()` will use existing results if they are available in the `SingleCellExperiment`, and will recalculate them otherwise. If we want, we can set `rerun=TRUE` to forcibly recalculate the PCs in the presence of existing results. Additional cell-specific information can be incorporated into the size or shape of each point (e.g. `size_by=` and `shape_by=` arguments).

We can also perform dimensionality reduction using our HVGs subset. To do this, we first calculate the PCA representation via the `runPCA()` function from the `scater` package. We will calculate 50 components on our highly variable genes. The results of these calculations will be stored in the `reducedDims` slot. This method saves the percent variance explained per component as an attribute, which can be accessed and subsequently ploted using the “elbow plot” as follows:
```{r}
PAG_sceset_qc_norm_filt_corr <- runPCA(PAG_sceset_qc_norm_filt_corr,
                                       ncomponents = 50,
                                       ntop = 2743, 
                                       exprs_values = "logcounts",
                                       feature_set = metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt)
reducedDimNames(PAG_sceset_qc_norm_filt_corr)
plotReducedDim(PAG_sceset_qc_norm_filt_corr, use_dimred="PCA", colour_by = "Slc32a1", shape_by = "cell.type", size_by = "total_features_by_counts")

# Elbow plot
pct_var_explained <- attr(reducedDim(PAG_sceset_qc_norm_filt_corr, "PCA"), "percentVar")
plot(pct_var_explained)
```

## Step 8.2 | Visualizing data in low-dimensional space with t-SNE
Another widely used approach for dimensionality reduction is the t-stochastic neighbour embedding (t-SNE) method (Van der Maaten and Hinton 2008). tSNE combines dimensionality reduction with random walks on the nearest-neighbour network to map high dimensional data to a 2-dimensional space while preserving local distances between cells. t-SNE tends to work better than PCA for separating cells in more diverse populations. This is because the former can directly capture non-linear relationships in high-dimensional space, whereas the latter must represent them (suboptimally) as linear components. However, this improvement comes at the cost of more computational effort and complexity. In particular, the non-linear and stochastic nature of the algorithm means that running it multiple times on the same dataset will result in different plots, making the results more difficult to intuitively interpret. Users should thus run the algorithm several times to ensure that the results are representative, and then set a `seed` to ensure that the chosen results are reproducible. It is also advisable to test different settings of the `perplexity` parameter as this will affect the distribution of points in the low-dimensional space.

tSNE plots are good for visualising your data, but should *NOT* be used for clustering. Furthermore, tSNE requires you to provide a value of `perplexity` which reflects the number of neighbours used to build the nearest-neighbour network - a high value creates a dense network which clumps cells together, whereas a low value makes the network more sparse allowing groups of cells to separate from each other. `scater` uses a default `perplexity` equal to the total number of cells divided by five (rounded down). You should try different perplexities and run it several times to make sure you are not getting a weird result. If your data are very homogeneous the tSNE plots are going to be hard to interpret, whereas if they contain very well defined clusters it will visualize them very nicely.

We can use the `plotTSNE()` function and set `use_dimred="PCA"` to perform the t-SNE on the low-rank approximation of the data, allowing the algorithm to take advantage of the previous denoising step.
```{r}
set.seed(1991)
range_of_perplexities = list(5, 10, 20, 50)
for(n in range_of_perplexities) {
    print(
        plotTSNE(
            PAG_sceset_qc_norm_filt_corr,
            rerun = TRUE, 
            ncomponents = 2, 
            colour_by = "PAG.area", # "batch.processing"
            shape_by = "cell.type",
            size_by = "total_features_by_counts",
            run_args = list(feature_set = metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt[1:1000], exprs_values = "corrected", 
                            use_dimred = "PCA", n_dimred = 17, perplexity = n, theta = 0.5)
        ) + ggtitle(paste("Perplexity = ", n))
        #+ coord_cartesian(xlim = c(-35, 35), ylim = c(-35, 35))
        #+ coord_cartesian(xlim = c(-50, 50), ylim = c(-60, 60))
    )
}

chosen <- rownames(PAG_sceset_qc_norm_filt_corr) %in% metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt 

# Consider playing with the ntop, n_dimred, perplexity, and theta arguments.
tsne_p5 <- plotTSNE(PAG_sceset_qc_norm_filt_corr, 
                    rerun = TRUE,
                    run_args = list(ncomponents = 2, ntop = 1000, feature_set = chosen, exprs_values = "corrected", 
                                    use_dimred = "PCA", n_dimred = 20, perplexity = 5, theta = 0.5),
                    colour_by = "batch.processing") + fontsize + ggtitle("Perplexity = 5")
# theta - numeric; Speed/accuracy trade-off (increase for less accuracy), set to 0.0 for exact TSNE (default: 0.5)
tsne_p10 <- plotTSNE(PAG_sceset_qc_norm_filt_corr, 
                     rerun = TRUE,
                     run_args = list(ncomponents = 2, ntop = 1000, feature_set = chosen, exprs_values = "corrected", 
                                     use_dimred = "PCA", n_dimred = 20, perplexity = 10, theta = 0.5),
                     colour_by = "cell.type") + fontsize + ggtitle("Perplexity = 10")

tsne_p20 <- plotTSNE(PAG_sceset_qc_norm_filt_corr,
                     rerun = TRUE,
                     run_args = list(ncomponents = 2, ntop = 1000, feature_set = chosen, exprs_values = "corrected", 
                                     use_dimred = "PCA", n_dimred = 20, perplexity = 20, theta = 0.5),
                     colour_by = "PAG.area") + fontsize + ggtitle("Perplexity = 20")

tsne_p50 <- plotTSNE(PAG_sceset_qc_norm_filt_corr,
                     rerun = TRUE,
                     run_args = list(ncomponents = 2, ntop = 1000, feature_set = chosen, exprs_values = "corrected", 
                                     use_dimred = "PCA", n_dimred = 20, perplexity = 50, theta = 0.5),
                     colour_by = "mouse.id") + fontsize + ggtitle("Perplexity = 50")

multiplot(tsne_p5, tsne_p10, tsne_p20, tsne_p50, cols = 2)
reducedDimNames(PAG_sceset_qc_norm_filt_corr)
```

Once we have the right settings, we can use `runTSNE()` to store the t-SNE results inside our `SingleCellExperiment` object. This avoids repeating the calculations whenever we want to create a new plot with `plotTSNE()`, as the stored results will be used instead. Again, users can set `rerun=TRUE` to force recalculation in the presence of stored results.
```{r}
set.seed(1991)
PAG_sceset_qc_norm_filt_corr <- runTSNE(PAG_sceset_qc_norm_filt_corr, 
                                   rerun = TRUE,
                                   use_dimred="PCA", 
                                   run_args = list(ncomponents = 2, ntop = 1000, feature_set = chosen, exprs_values = "corrected", 
                                                   use_dimred = "PCA", n_dimred =20, perplexity = 5, theta = 0.5)
                                   )

plotTSNE(PAG_sceset_qc_norm_filt_corr, colour_by="Gad1", shape_by="cell.type")
reducedDimNames(PAG_sceset_qc_norm_filt_corr)
```

## Step 8.3 | Visualizing data in low-dimensional space with uMAP
An alternative to calculate a 2-dimensional representation of the data is uniform manifold approximation and projection (uMAP), from [McInnes L, Healy J (2018). UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. arXiv](https://arxiv.org/abs/1802.03426). We can choose to use the top 20 components of our PCA result to compute the UMAP representation.
```{r}
PAG_sceset_qc_norm_filt_corr <- runUMAP(PAG_sceset_qc_norm_filt_corr, 
                                        rerun = TRUE,
                                        use_dimred = 'PCA', 
                                        n_dimred = 17,
                                        run_args = list(exprs_values = "logcounts"),
                                        colour_by = "batch.processing", # You can also choose a specific gene (e.g. "Gad1") or shape_by = "cell.type"
                                        shape_by="cell.type")

plotUMAP(PAG_sceset_qc_norm_filt_corr,
         rerun = TRUE,
         ncomponents = 2,
         run_args = list(feature_set = metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt[1:1000], exprs_values = "corrected"),
         colour_by = "PAG.area", # You can also choose a specific gene (e.g. "Gad1") or shape_by = "cell.type"
         shape_by="cell.type")

plotUMAP(PAG_sceset_qc_norm_filt_corr, 
         colour_by = "batch.processing") # You can also choose a specific gene (e.g. "Gad1") or shape_by = "cell.type"
```

## Step 8.4 | Other approaches to data exploration
### 8.4.1 | Heatmaps using HVGs
We can visualize the expression profiles of the HVGs with a heatmap. All expression values are mean-centred for each gene to highlight the relative differences in expression between cells. If any subpopulations were present, they would manifest as rectangular "blocks" in the heatmap, corresponding to sets of genes that are systematically up- or down-regulated in specific groups of cells. 
```{r}
chosen <- rownames(PAG_sceset_qc_norm_filt_corr) %in% metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt 
norm.exprs <- exprs(PAG_sceset_qc_norm_filt_corr)[chosen,,drop=FALSE] 
heat.vals <- norm.exprs - rowMeans(norm.exprs) 
library(gplots) 
heat.out <- heatmap.2(heat.vals, col=bluered, symbreak=TRUE, trace='none', cexRow=0.6)
```

### 8.4.2 | Clustering
```{r}
set.seed(1991)
start_time <- Sys.time() # Takes around 5s

snng <- buildSNNGraph(PAG_sceset_qc_norm_filt_corr, k = 50, d = 20)
snng_clusters <- igraph::cluster_louvain(snng)
table(snng_clusters$membership)
colData(PAG_sceset_qc_norm_filt_corr)$clusters <- as.factor(snng_clusters$membership)
plotUMAP(PAG_sceset_qc_norm_filt_corr, colour_by = "clusters")

end_time <- Sys.time()
end_time - start_time
```

### 8.4.3 | Differential Expression
```{r}
markers <- findMarkers(PAG_sceset_qc_norm_filt_corr, 
                       clusters = colData(PAG_sceset_qc_norm_filt_corr)$clusters,
                       subset.row = metadata(PAG_sceset_qc_norm_filt_corr)$hvg_out_no_spikes_filt[1:250],
                       lfc = 1.5, 
                       direction = 'up', 
                       log.p = TRUE)
markers[[1]][1:5, ]
plotExpression(PAG_sceset_qc_norm_filt_corr, 'Gad1', x = 'clusters')
```

### 8.4.4 | iSEE - interactive SummarizedExperiment Explorer
`iSEE` is a package that provides functions for creating an interactive Shiny-based graphical user interface for exploring data stored in `SummarizedExperiment` objects, including row- and column-level metadata. Particular attention is given to single-cell data in a `SingleCellExperiment` object with visualization of dimensionality reduction results.

Citation: Rue-Albrecht K, Marini F, Soneson C, Lun ATL (2018). "iSEE: Interactive SummarizedExperiment Explorer." F1000Research, 7, 741. doi: 10.12688/f1000research.14966.1.

# STEP 8 | Inspecting the data using violin and heatmaps plots
The following code aims at facilitating visualization by plotting the expression of different list of genes stored in the `SingleCellExperiment` object using heatmaps and violing plots.

Load `PAG_sceset_qc_norm_filt_corr` after clustering and differential expression analysis. We should thus have a `logcounts` slot in `assays`, as well as cluster identities and lists of HVG and DE genes. We should also still have our gene lists loaded into the `metadata` slot:
```{r}
# If starting from stored results, load saved filtered dataset from previous Step:
set.seed(1991)
options(stringsAsFactors = FALSE)
library(SingleCellExperiment)
library(scater)
library(scran)

PAG_sceset_qc_norm_filt_corr <- readRDS("PAG_sceset_qc_norm_filt_corr.rds")
assayNames(PAG_sceset_qc_norm_filt_corr)
PAG_sceset_qc_norm_filt_corr
names(metadata(PAG_sceset_qc_norm_filt_corr))
```

The following code chunks will follow the same structure. We first get the gene names we want to inspect from our previously loaded `PAG_scRNAseq_gene_lists`. We then filter any genes not present in our QCed dataset by comparing the gene names in the `metadata` list with the `rownames` of our expression matrix. We can next generate the violin or heatmap plots.

Some visualisation tricks:
* Use `PAG_ionchannels[1:20]` to select a subset of ion channels
* Alternate between `x = "PAG.area", colour_by = "cell.type"` or `x = "cell.type", colour_by = "PAG.area"`
* Use `ncol = 5` to speficy the number of columns the plot will be divided into

## Step 8.1 | Ion Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_ionchannels <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.ionchannels[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.ionchannels %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_ionchannels)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_ionchannels[1:20],  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_ionchannels[1:20],  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_ionchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Ion Channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/IonChannels_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_ionchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Ion Channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/IonChannels_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_ionchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Ion Channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/IonChannels_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.1 | Potassium Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_potassium <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icPotassium[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icPotassium %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_potassium)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_potassium,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_potassium,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_potassium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Potassium channels in", celltype, "cells"), 
                      width = 10, height = 15,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Potassium/Potassium_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_potassium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Potassium channels in", area, "VGAT cells"), 
                      width = 10, height = 15,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Potassium/Potassium_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_potassium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Potassium channels in", area, "VGluT2 cells"), 
                      width = 10, height = 15,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Potassium/Potassium_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.2 | Calcium Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_calcium <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icCalcium[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icCalcium %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_calcium)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_calcium,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_calcium,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_calcium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Calcium channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Calcium/Calcium_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_calcium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Calcium channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Calcium/Calcium_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_calcium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Calcium channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Calcium/Calcium_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.3 | Sodium Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_sodium <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icSodium[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icSodium %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_sodium)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_sodium,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_sodium,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_sodium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Sodium channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Sodium/Sodium_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_sodium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Sodium channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Sodium/Sodium_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_sodium,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Sodium channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Sodium/Sodium_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.4 | Chloride Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_chloride <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icChloride[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icChloride %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_chloride)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_chloride,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_chloride,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_chloride,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Chloride channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Chloride/Chloride_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_chloride,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Chloride channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Chloride/Chloride_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_chloride,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Chloride channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Chloride/Chloride_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.5 | Asic Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_asic <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icAsic[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icAsic %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_asic)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_asic,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_asic,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_asic,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("ASIC channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Asic/ASIC_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_asic,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("ASIC channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Asic/ASIC_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_asic,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("ASIC channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Asic/ASIC_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.6 | Cyclic Nucleotide Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_cyclic_nucleotides <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icCyclicnucleotides[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icCyclicnucleotides %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_cyclic_nucleotides)
 
# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_cyclic_nucleotides,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_cyclic_nucleotides,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_cyclic_nucleotides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Cyclic Nucleotide channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Cyclic/CyclicNucleotides_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_cyclic_nucleotides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Cyclic Nucleotide channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Cyclic/CyclicNucleotides_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_cyclic_nucleotides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Cyclic Nucleotide channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Cyclic/CyclicNucleotides_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.7 | TRP Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_trp <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icTRP[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icTRP %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_trp)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_trp,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_trp,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_trp,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("TRP channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/TRP/TRP_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_trp,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("TRP channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/TRP/TRP_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_trp,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("TRP channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/TRP/TRP_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.8 | Connexins
```{r} 
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_connexins <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icConnexins[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icConnexins %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_connexins)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_connexins,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_connexins,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_connexins,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Connexins in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Connexins/Connexins_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_connexins,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Connexins in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Connexins/Connexins_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_connexins,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Connexins in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Connexins/Connexins_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.9 | Purinergic Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_purinergic <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icP2X[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icP2X %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_purinergic)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_purinergic,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_purinergic,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_purinergic,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Purinergic Ion Channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Purinergic/PurinergicICs_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_purinergic,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Purinergic Ion Channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Purinergic/PurinergicICs_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_purinergic,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Purinergic Ion Channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Purinergic/PurinergicICs_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.10 | Aquaporins
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_aquaporins <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icAquaporins[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icAquaporins %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_aquaporins)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_aquaporins,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_aquaporins,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_aquaporins,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Aquaporins in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Aquaporins/Aquaporins_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_aquaporins,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Aquaporins in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Aquaporins/Aquaporins_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_aquaporins,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Aquaporins in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Aquaporins/Aquaporins_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.1.11 | Other Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_otherchannels <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icOther[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icOther %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_otherchannels)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_otherchannels,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_otherchannels,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_otherchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Other Ion Channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/OtherIC/OtherIC_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_otherchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Other Ion Channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/OtherIC/OtherIC_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_otherchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Other Ion Channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/OtherIC/OtherIC_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

## Step 8.2 | Neurotransmitter Receptors and Transporters
### 8.2.1 | GABA
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_gaba <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.GABA[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.GABA %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_gaba)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_gaba,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_gaba,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_gaba,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("GABA in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/GABA/GABA_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_gaba,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("GABA in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/GABA/GABA_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_gaba,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("GABA in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/GABA/GABA_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.2.2 | Glutamate
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_glutamate <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Glutamate[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Glutamate %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_glutamate)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_glutamate,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_glutamate,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_glutamate,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Glutamate in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Glutamate/Glutamate_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_glutamate,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Glutamate in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Glutamate/Glutamate_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_glutamate,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Glutamate in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Glutamate/Glutamate_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.2.3 | Acetylcholine
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_acetylcholine <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Acetylcholine[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Acetylcholine %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_acetylcholine)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_acetylcholine,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_acetylcholine,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_acetylcholine,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Acetylcholine in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Acetylcholine/Acetylcholine_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_acetylcholine,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Acetylcholine in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Acetylcholine/Acetylcholine_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_acetylcholine,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Acetylcholine in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Acetylcholine/Acetylcholine_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.2.4 | Transporters
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_transporters <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Transporters[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Transporters %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_transporters)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_transporters,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_transporters,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_transporters,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Transporters Genes in", celltype, "cells"), 
                      width = 40, height = 50,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Transporters/Transporters_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_transporters,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Transporters Genes in", area, "VGAT cells"), 
                      width = 40, height = 50,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Transporters/Transporters_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_transporters,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Transporters Genes in", area, "VGluT2 cells"), 
                      width = 40, height = 50,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Transporters/Transporters_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

## Step 8.3 | Neuromodulators and Neuropeptides
### 8.3.1 | Monoamines
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_monoamines <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Monoamines[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Monoamines %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_monoamines)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_monoamines,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_monoamines,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_monoamines,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Monoamines in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Monoamines/Monoamines_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_monoamines,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Monoamines in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Monoamines/Monoamines_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_monoamines,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Monoamines in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Monoamines/Monoamines_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.3.2 | Neuromodulators
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_neuromodulators <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Neuromodulators[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Neuromodulators %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_neuromodulators)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_neuromodulators,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_neuromodulators,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_neuromodulators,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuromodulators in", celltype, "cells"), 
                      width = 13, height = 20,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Neuromodulators/Neuromodulators_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_neuromodulators,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuromodulators in", area, "VGAT cells"), 
                      width = 13, height = 20,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Neuromodulators/Neuromodulators_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_neuromodulators,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuromodulators in", area, "VGluT2 cells"), 
                      width = 13, height = 20,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Neuromodulators/Neuromodulators_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.3.3 | Neuropeptides
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_neuropeptides <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Neuropeptides[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Neuropeptides %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_neuropeptides)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_neuropeptides,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_neuropeptides,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_neuropeptides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuropeptides in", celltype, "cells"), 
                      width = 10, height = 15,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Neuropeptides/Neuropeptides_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_neuropeptides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuropeptides in", area, "VGAT cells"), 
                      width = 10, height = 15,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Neuropeptides/Neuropeptides_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_neuropeptides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuropeptides in", area, "VGluT2 cells"), 
                      width = 10, height = 15,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/Neuropeptides/Neuropeptides_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

## STEP 8.4 | DE genes from DESeq2 analysis
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_DEseq2_icgenes <- rownames(PAG_DESeq_results_1_wald_ordered)[(rownames(PAG_DESeq_results_1_wald_ordered) %in% metadata(PAG_sceset_qc_norm_filt_corr)$genes.ionchannels)]
PAG_DEseq2_nmgenes <- rownames(PAG_DESeq_results_1_wald_ordered)[(rownames(PAG_DESeq_results_1_wald_ordered) %in% metadata(PAG_sceset_qc_norm_filt_corr)$genes.NeuromodulatorsPeptides)]
PAG_DEseq2_genes <- c(PAG_DEseq2_icgenes, PAG_DEseq2_nmgenes)
length(PAG_DEseq2_genes)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_DEseq2_genes,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_DEseq2_genes,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_DEseq2_genes,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("DE Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DESeq2_genes/DESeq2_genes_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_DEseq2_genes,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("DE Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DESeq2_genes/DESeq2_genes_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_DEseq2_genes,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("DE Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DESeq2_genes/DESeq2_genes_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

## Step 8.5 | Gene Lists from Literature and Labs
### 8.5.1 | Cell type markers
(i) oligodendrocytes (mRNAs for myelin basic protein (Mbp) and UDP glyco- syltransferase-8 (Ugt8) involved in sphingolipid metabolism); 
(ii) astrocytes (genes Fabp7 and Ntsr2); 
(iii) ependymal cells (genes associated with motile cilia, including Enkur9 and the transcription factor Foxj1); 
(iv) microglia (mRNAs for macrophage lineage marker allograft inflammatory factor 1 (Aif1) and immunoglobulin E receptor (Fcer1g)); 
(v) endothelial cells (genes encoding fibronectin (Fn1) and organic anion transporter (Slco1a4)); 
(vi) vascular and smooth muscle lineage (mRNAs for the α2 subunit of actin (Acta2) and transgelin (Tagln)); 
and (vii) neurons (genes Ndrg4 and Stmn2).
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_celltypes <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.CellTypeMarkers[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.CellTypeMarkers %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_celltypes)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_celltypes,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_celltypes,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_celltypes,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Cell Type Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/CellTypeMarkers/CellTypeGenes_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_celltypes,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Cell Type Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/CellTypeMarkers/CellTypeGenes_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_celltypes,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Cell Type Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/CellTypeMarkers/CellTypeGenes_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.5.2 | Interneuron Markers
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_interneurons <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.InterneuronMarkers[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.InterneuronMarkers %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_interneurons)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_interneurons,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_interneurons,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_interneurons,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Interneuron Markers in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/InterneuronMarkers/InterneuronMarkers_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_interneurons,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Interneuron Markers in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/InterneuronMarkers/InterneuronMarkers_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_interneurons,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Interneuron Markers in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/InterneuronMarkers/InterneuronMarkers_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.5.3 | DE genes from QMUL
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_DEgenesQMUL <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.QMULDE[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.QMULDE %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_DEgenesQMUL)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_DEgenesQMUL,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_DEgenesQMUL,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_DEgenesQMUL,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("QMUL DE Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/QMUL_DE/QMUL_DE_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_DEgenesQMUL,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("QMUL DE Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/QMUL_DE/QMUL_DE_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_DEgenesQMUL,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("QMUL DE Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/QMUL_DE/QMUL_DE_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.5.4 | DE genes from Miguel Branco
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_DEgenesMB <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.MBrancoDE[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.MBrancoDE %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_DEgenesMB)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_DEgenesMB,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_DEgenesMB,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_DEgenesMB,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("MB DE Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/MB_DE_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_DEgenesMB,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("MB DE Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/MB_DE_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_DEgenesMB,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("MB DE Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/MB_DE_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.5.5 | Yang Dan's Sleep Genes
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_Dan <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.DanSleep[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.DanSleep %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_Dan)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_Dan,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_Dan,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_Dan,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Dan Lab Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DanLabGenes/DanLabGenes_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_Dan,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Dan Lab Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DanLabGenes/DanLabGenes_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_Dan,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Dan Lab Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DanLabGenes/DanLabGenes_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.5.6 | Cornelius Gross's Genes
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_Gross <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.Gross[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.Gross %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_Gross)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_Gross,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_Gross,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_Gross,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Gross Lab Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/GrossLabGenes/GrossLabGenes_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_Gross,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Gross Lab Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/GrossLabGenes/GrossLabGenes_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_Gross,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Gross Lab Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/GrossLabGenes/GrossLabGenes_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.5.7 | Darios's SC Genes
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
PAG_Dario <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.DarioSC[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.DarioSC %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(PAG_Dario)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_Dario,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, PAG_Dario,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], PAG_Dario,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Dario's Genes in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DariosGenes/DariosGenes_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], PAG_Dario,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Dario's Genes in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DariosGenes/DariosGenes_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], PAG_Dario,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Dario's Genes in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/DariosGenes/DariosGenes_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

## Step 8.6 | Data Club plots
### 8.6.1 | Data Club Ion Channels
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
DataClub_ionchannels <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.icDataClub[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.icDataClub %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(DataClub_ionchannels)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, DataClub_ionchannels,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, DataClub_ionchannels,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], DataClub_ionchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Ion Channels in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/ICDataClub/ICDataClub_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], DataClub_ionchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Ion Channels in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/ICDataClub/ICDataClub_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], DataClub_ionchannels,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Ion Channels in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/ICDataClub/ICDataClub_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.6.2 | Data Club Neuromodulators
```{r}
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
DataClub_neuromodulators <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.nmDataClub[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.nmDataClub %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(DataClub_neuromodulators)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, DataClub_neuromodulators,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, DataClub_neuromodulators,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], DataClub_neuromodulators,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuromodulators in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/nmDataClub/nmDataClub_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], DataClub_neuromodulators,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuromodulators in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/nmDataClub/nmDataClub_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], DataClub_neuromodulators,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuromodulators in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/nmDataClub/nmDataClub_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```

### 8.6.3 | Data Club Neuropeptides
```{r} 
# Get the ion channel gene names from the appropriate column and filter any genes not present in our dataset:
DataClub_neuropeptides <- metadata(PAG_sceset_qc_norm_filt_corr)$genes.npDataClub[(metadata(PAG_sceset_qc_norm_filt_corr)$genes.npDataClub %in% rownames(PAG_sceset_qc_norm_filt_corr))]
length(DataClub_neuropeptides)

# Make violing plots
plotExpression(PAG_sceset_qc_norm_filt_corr, DataClub_neuropeptides,  
               x = "cell.type", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 10, show_median = TRUE,
               xlab ="Cell Type")

plotExpression(PAG_sceset_qc_norm_filt_corr, DataClub_neuropeptides,  
               x = "PAG.area", colour_by = "cell.type",
               exprs_values = "logcounts", ncol = 5, show_median = TRUE,
               xlab = "PAG subdivision")

# Define colors for the heatmaps:
heatcolor_VGAT <- colorRampPalette(c("white", "#ff777c"))(100)
heatcolor_VGluT2 <- colorRampPalette(c("white", "#009CB5"))(100)

# Make Heatmaps by cell type
for(celltype in levels(PAG_sceset_qc_norm_filt_corr$cell.type)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$cell.type==celltype], DataClub_neuropeptides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = eval(parse(text=paste("heatcolor_", celltype, sep = ""))), border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuropeptides in", celltype, "cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/npDataClub/npDataClub_", celltype, "_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGAT cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGAT"], DataClub_neuropeptides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGAT, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuropeptides in", area, "VGAT cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/npDataClub/npDataClub_", area, "_VGAT_cells.png", sep = "")
                      )
  print(plot)
  }

# Make Heatmaps by PAG subdivision (VGluT2 cells)
for(area in levels(PAG_sceset_qc_norm_filt_corr$PAG.area)){
  plot <- plotHeatmap(PAG_sceset_qc_norm_filt_corr[, PAG_sceset_qc_norm_filt_corr$PAG.area==area & PAG_sceset_qc_norm_filt_corr$cell.type=="VGluT2"], DataClub_neuropeptides,
                      exprs_values = "logcounts", 
                      center = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, zlim = c(0,12),
                      color = heatcolor_VGluT2, border_color = NA,              
                      fontsize = 12,# cellwidth = 2, cellheight = 3, 
                      show_colnames = TRUE, show_rownames = TRUE, angle_col = 45,            
                      main = paste("Neuropeptides in", area, "VGluT2 cells"), 
                      width = 6, height = 8,
                      filename = paste("D:/Dropbox (UCL - SWC)/Project_transcriptomics/figures/R_figures/Heatmaps/npDataClub/npDataClub_", area, "_VGluT2_cells.png", sep = "")
                      )
  print(plot)
  }
```